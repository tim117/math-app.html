<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°äºŒæ•¸å­¸ç›´å¼ç·´ç¿’</title>
    <style>
        /* --- åŸºç¤è¨­å®š & é˜²æ­¢æ²å‹• --- */
        :root {
            --bg-color: #fdfdfd;
            --grid-color: #aaddff;
            --text-color: #333;
            --primary-color: #4a90e2;
            --accent-color: #ff5e5e; /* ç´…è‰²æç¤º */
            --btn-shadow: #888;
        }

        * {
            box-sizing: border-box;
            user-select: none; /* ç¦æ­¢é¸å–æ–‡å­— */
            -webkit-user-select: none;
            touch-action: manipulation;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden; /* ç¦æ­¢æ²å‹• */
            overscroll-behavior: none; /* ç¦æ­¢ iOS æ©¡çš®ç­‹æ•ˆæœ */
            font-family: 'Comic Sans MS', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
        }

        /* --- æ–¹æ ¼ç´™èƒŒæ™¯ --- */
        .paper-bg {
            background-image: 
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 40px 40px; /* å¤§æ–¹æ ¼é©åˆå°é½Š */
            background-position: center top;
            flex: 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- é¡Œç›®å€åŸŸ (ç›´å¼æ’åˆ—) --- */
        .math-container {
            position: relative;
            font-size: 4rem;
            font-weight: bold;
            color: var(--text-color);
            line-height: 1.2;
            text-align: right;
            z-index: 10; /* åœ¨ç•«å¸ƒä¸‹æ–¹ï¼Œä½†åœ¨èƒŒæ™¯ä¸Šæ–¹... ç­‰ç­‰ï¼Œç•«å¸ƒè¦åœ¨æœ€ä¸Šå±¤ */
            pointer-events: none; /* è®“é»æ“Šç©¿é€åˆ° canvas */
            padding: 20px;
            background: rgba(255,255,255,0.6); /* è¼•å¾®ç™½åº•å¢åŠ å°æ¯” */
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .row {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            letter-spacing: 0.5rem;
            position: relative;
        }

        .operator {
            position: absolute;
            left: -50px;
            font-size: 3rem;
        }

        .divider {
            height: 4px;
            background-color: var(--text-color);
            margin: 10px 0;
            border-radius: 2px;
        }

        /* ç­”æ¡ˆè¼¸å…¥æ¡† (æ¨¡æ“¬) */
        .answer-box {
            height: 80px;
            border: 2px dashed #999;
            background: #fff;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            border-radius: 8px;
            min-width: 160px;
        }

        .answer-box.correct {
            border: 3px solid #4CAF50;
            color: #4CAF50;
            background: #e8f5e9;
        }

        .answer-box.wrong {
            border: 3px solid var(--accent-color);
            animation: shake 0.4s ease-in-out;
        }

        /* --- æ™ºæ…§æç¤º (é€²ä½/é€€ä½) --- */
        .hint-bubble {
            position: absolute;
            top: -10px; /* åœ¨åä½æ•¸ä¸Šæ–¹ */
            right: 85px; /* èª¿æ•´è‡³åä½æ•¸ä½ç½® */
            width: 40px;
            height: 40px;
            border: 3px solid var(--accent-color);
            color: var(--accent-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            background: white;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .hint-bubble.show {
            opacity: 1;
            transform: scale(1);
        }

        /* --- æ‰‹å¯«ç•«å¸ƒ --- */
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 20; /* æœ€ä¸Šå±¤ï¼Œæ¥æ”¶è§¸æ§ */
            touch-action: none; /* é—œéµï¼šå®Œå…¨æ¥ç®¡è§¸æ§ï¼Œé˜²æ­¢æ²å‹• */
            cursor: crosshair;
        }

        /* --- æ“¬çœŸéµç›¤ --- */
        .keypad {
            background-color: #e0e0e0;
            padding: 20px;
            padding-bottom: 30px; /* é©æ‡‰ iPhone Home bar */
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.1);
            z-index: 30;
        }

        .btn {
            background: #f0f0f0;
            border: none;
            border-radius: 12px;
            height: 70px;
            font-size: 2rem;
            font-weight: bold;
            color: #444;
            box-shadow: 0 4px 0 #bbb;
            active: translateY(4px);
            transition: all 0.1s;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn:active {
            box-shadow: 0 0 0 #bbb;
            transform: translateY(4px);
        }

        .btn-del {
            background-color: #ffcccc;
            color: #d32f2f;
            box-shadow: 0 4px 0 #e57373;
        }
        .btn-del:active { box-shadow: 0 0 0 #e57373; }

        .btn-ok {
            background-color: #4CAF50;
            color: white;
            box-shadow: 0 4px 0 #2E7D32;
        }
        .btn-ok:active { box-shadow: 0 0 0 #2E7D32; }

        /* --- å‹•ç•« --- */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* ç‹€æ…‹è¨Šæ¯ */
        .message {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.9);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1.2rem;
            color: #666;
            pointer-events: none;
            z-index: 25;
            display: none;
        }

    </style>
</head>
<body>

    <div class="message" id="msgBox">è«‹è¨ˆç®—ç­”æ¡ˆ</div>

    <div class="paper-bg" id="drawArea">
        <div class="math-container">
            <div id="hint" class="hint-bubble">1</div>

            <div class="row">
                <span id="num1">00</span>
            </div>
            <div class="row">
                <span class="operator" id="op">+</span>
                <span id="num2">00</span>
            </div>
            <div class="divider"></div>
            <div class="row">
                <div class="answer-box" id="display">?</div>
            </div>
        </div>
        <canvas id="scribbleCanvas"></canvas>
    </div>

    <div class="keypad">
        <button class="btn" onclick="inputNum(1)">1</button>
        <button class="btn" onclick="inputNum(2)">2</button>
        <button class="btn" onclick="inputNum(3)">3</button>
        <button class="btn" onclick="inputNum(4)">4</button>
        <button class="btn" onclick="inputNum(5)">5</button>
        <button class="btn" onclick="inputNum(6)">6</button>
        <button class="btn" onclick="inputNum(7)">7</button>
        <button class="btn" onclick="inputNum(8)">8</button>
        <button class="btn" onclick="inputNum(9)">9</button>
        <button class="btn btn-del" onclick="delNum()">âŒ«</button>
        <button class="btn" onclick="inputNum(0)">0</button>
        <button class="btn btn-ok" onclick="submitAnswer()">OK</button>
    </div>

<script>
    // --- è®Šæ•¸è¨­å®š ---
    let currentInput = "";
    let n1, n2, isAdd;
    let correctAnswer;
    let isProcessing = false; // é˜²æ­¢é€£çºŒé»æ“Š

    const displayEl = document.getElementById('display');
    const num1El = document.getElementById('num1');
    const num2El = document.getElementById('num2');
    const opEl = document.getElementById('op');
    const hintEl = document.getElementById('hint');
    const msgEl = document.getElementById('msgBox');
    
    // --- åˆå§‹åŒ–é¡Œç›® ---
    function generateQuestion() {
        isProcessing = false;
        currentInput = "";
        displayEl.innerText = "?";
        displayEl.className = "answer-box"; // é‡ç½®æ¨£å¼
        hintEl.classList.remove('show');
        msgEl.style.display = 'none';

        // éš¨æ©Ÿæ±ºå®šåŠ æ³•æˆ–æ¸›æ³•
        isAdd = Math.random() > 0.5;

        // ç”Ÿæˆå…©ä½æ•¸ (10-99)
        n1 = Math.floor(Math.random() * 90) + 10;
        n2 = Math.floor(Math.random() * 90) + 10;

        if (isAdd) {
            // åŠ æ³•ï¼šéš¨æ©Ÿï¼Œä½†æœ€å¥½ä¸è¦è¶…é150ä»¥å…å¤ªé›£ (é€™è£¡ä¸åšé™åˆ¶ï¼Œä¾éœ€æ±‚)
            opEl.innerText = "+";
            correctAnswer = n1 + n2;
        } else {
            // æ¸›æ³•ï¼šç¢ºä¿ä¸å‡ºç¾è² æ•¸ï¼Œä¸”è¢«æ¸›æ•¸è¦æ˜¯å…©ä½æ•¸
            if (n1 < n2) [n1, n2] = [n2, n1]; // äº¤æ›ç¢ºä¿ n1 >= n2
            opEl.innerText = "-";
            correctAnswer = n1 - n2;
        }

        num1El.innerText = n1;
        num2El.innerText = n2;

        // æ›é¡Œæ™‚è‡ªå‹•æ¸…é™¤ç•«å¸ƒ
        clearCanvas();
    }

    // --- éµç›¤é‚è¼¯ ---
    function inputNum(num) {
        if (isProcessing) return; // ç­”å°å¾Œæš«åœè¼¸å…¥
        if (currentInput.length >= 3) return; // é™åˆ¶é•·åº¦
        
        currentInput += num;
        displayEl.innerText = currentInput;
        displayEl.classList.remove('wrong'); // è¼¸å…¥æ™‚ç§»é™¤éŒ¯èª¤ç‹€æ…‹
    }

    function delNum() {
        if (isProcessing) return;
        currentInput = currentInput.slice(0, -1);
        displayEl.innerText = currentInput === "" ? "?" : currentInput;
    }

    function submitAnswer() {
        if (isProcessing) return;
        if (currentInput === "") return;

        const userAns = parseInt(currentInput);

        if (userAns === correctAnswer) {
            // ç­”å°é‚è¼¯
            handleCorrect();
        } else {
            // ç­”éŒ¯é‚è¼¯
            handleWrong();
        }
    }

    function handleCorrect() {
        isProcessing = true;
        displayEl.classList.add('correct');
        displayEl.innerText = "ğŸ‘ " + currentInput;
        hintEl.classList.remove('show'); // ç­”å°éš±è—æç¤º
        
        // æ’­æ”¾ç°¡å–®éŸ³æ•ˆæˆ–è¦–è¦ºå›é¥‹ (æ­¤è™•ä»¥å»¶é²æ›é¡Œç‚ºä¸»)
        setTimeout(() => {
            generateQuestion();
        }, 1500);
    }

    function handleWrong() {
        displayEl.classList.add('wrong');
        currentInput = ""; // æ¸…ç©ºè¼¸å…¥è®“å­©å­é‡æ‰“
        displayEl.innerText = "?";
        
        // --- æ ¸å¿ƒï¼šæ™ºæ…§æç¤ºé‚è¼¯ ---
        checkAndShowHint();
    }

    function checkAndShowHint() {
        const u1 = n1 % 10; // å€‹ä½æ•¸
        const u2 = n2 % 10;
        
        if (isAdd) {
            // åŠ æ³•é€²ä½æª¢æ¸¬ï¼šå€‹ä½æ•¸ç›¸åŠ  >= 10
            if (u1 + u2 >= 10) {
                hintEl.innerText = "1";
                hintEl.style.borderColor = "#ff5e5e";
                hintEl.style.color = "#ff5e5e";
                hintEl.classList.add('show');
            }
        } else {
            // æ¸›æ³•é€€ä½æª¢æ¸¬ï¼šè¢«æ¸›æ•¸å€‹ä½ < æ¸›æ•¸å€‹ä½
            if (u1 < u2) {
                hintEl.innerText = "é€€";
                hintEl.style.borderColor = "#ff5e5e";
                hintEl.style.color = "#ff5e5e";
                hintEl.classList.add('show');
            }
        }
    }

    // --- ç•«å¸ƒåŠŸèƒ½ (Canvas) ---
    const canvas = document.getElementById('scribbleCanvas');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;

    // èª¿æ•´ Canvas å¤§å°
    function resizeCanvas() {
        const parent = document.querySelector('.paper-bg');
        canvas.width = parent.clientWidth;
        canvas.height = parent.clientHeight;
        
        // è¨­å®šç•«ç­†æ¨£å¼
        ctx.strokeStyle = "#555"; // é‰›ç­†ç°
        ctx.lineJoin = "round";
        ctx.lineCap = "round";
        ctx.lineWidth = 3;
    }

    window.addEventListener('resize', resizeCanvas);
    
    // ç¹ªåœ–äº‹ä»¶
    function getTouchPos(canvas, evt) {
        const rect = canvas.getBoundingClientRect();
        return {
            x: (evt.touches[0].clientX - rect.left),
            y: (evt.touches[0].clientY - rect.top)
        };
    }

    function startDraw(e) {
        isDrawing = true;
        // æ”¯æ´æ»‘é¼ èˆ‡è§¸æ§
        const pos = e.type.includes('touch') ? getTouchPos(canvas, e) : {x: e.offsetX, y: e.offsetY};
        [lastX, lastY] = [pos.x, pos.y];
    }

    function draw(e) {
        if (!isDrawing) return;
        e.preventDefault(); // é˜²æ­¢æ»‘å‹•ç•«é¢
        const pos = e.type.includes('touch') ? getTouchPos(canvas, e) : {x: e.offsetX, y: e.offsetY};
        
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
        [lastX, lastY] = [pos.x, pos.y];
    }

    function stopDraw() {
        isDrawing = false;
    }

    // ç¶å®šäº‹ä»¶
    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDraw);
    canvas.addEventListener('mouseout', stopDraw);

    canvas.addEventListener('touchstart', startDraw, {passive: false});
    canvas.addEventListener('touchmove', draw, {passive: false});
    canvas.addEventListener('touchend', stopDraw);

    function clearCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    // --- å•Ÿå‹•ç¨‹å¼ ---
    window.onload = function() {
        resizeCanvas();
        generateQuestion();
    };

</script>
</body>
</html>
